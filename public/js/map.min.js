!function($){$("document").ready(function(){var a=window.location.hash,b=$("#map")[0],c=new google.maps.LatLng(32.98332409183747,-117.08404541015625),d={zoom:3,center:c,disableDefaultUI:!1,mapTypeControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!1},e=new google.maps.Map(b,d),f={marker:null,toppos:null,leftpos:null},g={green:"#19664a",blue:"#487b86",yellow:"#af845a",red:"#b75654"},h=new google.maps.OverlayView,i=[{elementType:"geometry",stylers:[{saturation:-100},{weight:.4}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"off"}]}],j=new google.maps.StyledMapType(i,{map:e,name:"Styled Map"}),k=[],l=function(a,b){var c=$("<p />",{html:"<b>Date/Time:</b> "+moment(a.time).format("llll")}),d=$("<p />",{html:"<b>Magnitude:</b> "+a.mag}),e=$("<p />",{html:"<b>Location:</b> "+a.place}),f=$("<a />",{"class":"close_window"}).css("background","top left url(/images/close-window.png) "+b),g=$("<div />",{"class":"infowindow_content"});return g.append(f,c,d,e),g},m=function(b){window.location.hash&&(a=a.substring(1,a.length),a=a.split(","));var c=b.features;$.each(c,function(a,b){var c,d=b.properties,i=b.geometry,j=new google.maps.LatLng(i.coordinates[1],i.coordinates[0]),m=new google.maps.Marker({position:j,title:"M: "+d.mag+" R: "+d.place}),n=Number(d.mag),o=g.red;(1>n||n>=0&&3>=n)&&(o=g.green),n>=3.1&&4>=n&&(o=g.blue),n>=4.1&&5>=n&&(o=g.yellow),c=l(d,o),m.setIcon({path:google.maps.SymbolPath.CIRCLE,fillOpacity:1,fillColor:o,strokeColor:"#232323",strokeOpacity:.5,strokeWeight:1,scale:10}),google.maps.event.addListener(m,"click",function(){var a,b,d=$(".infowindow_wrapper"),e=h.getProjection(),g=e.fromLatLngToContainerPixel(this.position);null!==f.marker&&d.empty(),d.html(c),a=g.y-d.height()-25,b=g.x-110,f.marker=this,f.toppos=a,f.leftpos=b,d.css({top:a,left:b}).fadeIn("fast"),window.location.hash=i.coordinates[1]+","+i.coordinates[0]}),k.push(m),m.setMap(e)}),a&&2===a.length&&(e.setCenter(new google.maps.LatLng(a[0],a[1])),e.setZoom(14))},n=function(){return $.ajax({type:"GET",url:"/get-json",dataType:"json"})},o=function(){var a=n();0!==k.length&&($.each(k,function(a,b){b.setMap(null)}),k=[]),a.done(m)};$(document).on("click","a.close_window",function(){$(".infowindow_wrapper").fadeOut("fast",function(){$(this).css({top:"-9999px",left:"-9999px"}),f.marker=null,f.toppos=null,f.leftpos=null})}),google.maps.event.addListener(e,"idle",function(){if(null!==f.marker){var a=$(".infowindow_wrapper"),b=h.getProjection(),c=b.fromLatLngToContainerPixel(f.marker.position),d=c.y-a.height()-25,e=c.x-110;a.css({top:d,left:e})}}),e.mapTypes.set("map-style",j),e.setMapTypeId("map-style"),h.setMap(e),h.draw=function(){},o(),setInterval(o,6e4)})}(jQuery);